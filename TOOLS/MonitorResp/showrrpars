#! /usr/local/GASP/bin/spi 
#/* -*- c -*- */
# "$Id: showrrpars,v 1.1 2004/09/29 16:20:43 mark Exp mark $" 


proc DrawAxis(ww)
{
  // should be in mins

      rs = w_getRS(ww)
	//<<" $_cproc $ww $rs \n"
      
      rx = rs[1] 
      ry = rs[2]
      rX = rs[3] 
      rY = rs[4]

      //<<" $rs \n"

            dy = (rY - ry )

            dx = (rX -rx)

	    ix = get_incr (dx)

            iy = get_incr ( dy)

<<" incr $ix $iy \n"

            int irx = rx/ix

            rx = irx * ixx

      <<" $rx a$ry $rX $rY \n"

            int iry = ry/iy
            ry = iry * iy

            W_SetPen(ww,"black")

            ticks(ww,1,rx,rX,ix,0.02)

            ticks(ww,2,ry,rY,iy,0.02)

            axnum(ww,1,rx+2*ix,rX-2*ix,2*ix,-2.0,"3.0f")

            axnum(ww,2,ry+iy,rY,4*iy,-4.0,"g")

        w_clipborder(ww)
}



A = 0

      //<<" $0 $1 $2 $3 \n"
    fname = $2
      //fnameSO = "${fname}.so2"
    fnameRI = "${fname}.ri"

<<" $fnameRR $fnameRI \n"
C= ofr(fnameRI)

R3 = ReadRecord(C,"type","float")

sz = Caz(R3)

dmn = Cab(R3)

<<" $sz $dmn \n"

<<" $R3[0;10][*] \n"

RI35 = R3[*][3]

  Redimn(RI35)

// ecg_pr
  PR = R3[*][6] 

  Redimn(PR)

// ecg_rr
  RR = R3[*][5] 

  Redimn(RR)

// find number of values for the file
  
  sz = Caz(RI35)


      ymin = 0
      ymax = 120
      xmin = 0
      xmax = sz
    
      //<<" %V $xmin $xmax \n"

aw= CreateGwindow("title","RR_PARS","scales",xmin,ymin,xmax,ymax,"savescales",0))


//<<" CGW $aw \n"

    SetGwindow(aw,"resize",0.1,0.1,0.9,0.7,0)
    SetGwindow(aw,"drawon")
    //SetGwindow(aw,"scales",xmin,ymin,xmax,ymax,"savescales",0)

    SetGwindow(aw,"resize",0.1,0.1,0.9,0.90,0)
    SetGwindow(aw,"clip",0.1,0.1,0.8,0.9)

    woysp = 0.03
    woht = 0.07

    woy = 0.8
    woY = woy + woht

    woxwd = 0.09

    wox = 0.9
    woX = wox + woxwd

    zoywo=w_CreateWO(aw,"ONOFF","ZOY",1,wox,woy,woX,woY,2,"red","medium","white")

    woset(zoywo,"help","Zoom out Y axis")

    woY = woy - woysp
    woy = woY - woht

    ziywo=w_CreateWO(aw,"ONOFF","ZIY",1,wox,woy,woX,woY,2,"blue","medium","white")

    woset(ziywo,"help","Zoom in Y axis")

    woY = woy - woysp
    woy = woY - woht

    zoxwo=w_CreateWO(aw,"ONOFF","ZOX",1,wox,woy,woX,woY,2,"red","medium","white")

    woset(zoxwo,"help","Zoom out X axis")

    woY = woy - woysp
    woy = woY - woht

    zixwo=w_CreateWO(aw,"ONOFF","ZIX",1,wox,woy,woX,woY,2,"blue","medium","white")

    woset(zixwo,"help","Zoom in X axis")

    woY = woy - woysp
    woy = woY - woht

    puywo=w_CreateWO(aw,"ONOFF","PUY",1,wox,woy,woX,woY,2,"blue","medium","white")
    woset(puwwo,"help","Pan up Y axis")

    woY = woy - woysp
    woy = woY - woht

    pdywo=w_CreateWO(aw,"ONOFF","PDY",1,wox,woy,woX,woY,2,"blue","medium","white")
    woset(pdywo,"help","Pan down ")

    woY = woy - woysp
    woy = woY - woht

    plwo=w_CreateWO(aw,"ONOFF","PANL",1,wox,woy,woX,woY,2,"blue","medium","white")
    woset(plwo,"help","Pan left ")

    woY = woy - woysp
    woy = woY - woht

    prwo=w_CreateWO(aw,"ONOFF","PANR",1,wox,woy,woX,woY,2,"red","medium","white")
    woset(prwo,"help","Pan right ")

  //////////////////////////////////////////////////////////////////////////////////


  XVRI = Fgen(sz,0,1)

  ri35=CreateGline("wid",aw,"type","XY","xvec",XVRI,"yvec",RI35,"color", "black","usescales",0)
  DrawGline(ri35)

  prgl=CreateGline("wid",aw,"type","XY","xvec",XVRI,"yvec",PR,"color", "red","usescales",0)
  DrawGline(prgl)

  rrgl=CreateGline("wid",aw,"type","XY","xvec",XVRI,"yvec",RR,"color", "blue","usescales",0)
  DrawGline(rrgl)


  PR35 = R3[*][7]
  SO = R3[*][8]


  Redimn(PR35)
  Redimn(SO)
  sz = Caz(SO)

  pr35=CreateGline("wid",aw,"type","XY","xvec",XVRI,"yvec",PR35,"color", "green","usescales",0)
  DrawGline(pr35)

  so35=CreateGline("wid",aw,"type","XY","xvec",XVRI,"yvec",SO,"color", "yellow","usescales",0)
  DrawGline(so35)



      // redraw
      // if not gwm -exit
 Graphic = CheckGwm()

<<" %v $Graphic \n"

if (! Graphic) STOP!


 plw = aw

int Minfo[10+]

pfname ="ypic"

   while (1) {

    WoRedraw(plw)

    zoomit = 0

    w_activate(plw)

    msg = MessageWait(Minfo)
<<" $msg $Minfo \n"

   if ( ! (msg @= "NO_MSG")) {

    zmn = msg 
    winid = Minfo[2]

    if ( (msg @= "PRINT") ) {
     open_laser(pfname)
     scr_laser(plw)
     gsync()
    }


    if (msg @= "PANR") {
      PanRight(aw)
      zoomit = 1
    }
    if (msg @= "PANL") {
      PanLeft(aw)
      zoomit = 1
    }



    if ((msg @= "ZOY")) {
      ZoomOutYaxis(plw)
      zoomit = 1
    }

    if (msg @= "ZOX") {
      ZoomOutXaxis(plw)
      zoomit = 1
    }

    if (msg @= "ZIY") {
      ZoomInYaxis(plw)
      zoomit = 1
    }

    if (msg @= "ZIX") {
      ZoomInXaxis(plw)
      zoomit = 1
    }

    if (msg @= "PUY") {
      SetGwindow(aw,"usescales",0)
      PanUp(aw)
      zoomit = 1
    }

    if (msg @= "PDY") {
      PanDown(aw)
      zoomit = 1
    }


    if ( (msg @= "REDRAW") || (msg @= "RESIZE") ||  zoomit || (msg @= "PRINT")) {

      //      <<" RedrawGlines for $plw \n"

      SetGwindow(aw,"clearpixmap","clearclip")
      RedrawGlines(aw)
      SetGwindow(aw,"showpixmap","store")
      DrawAxis(aw)

    }


    if ( (msg @= "PRINT") ) {
          CloseLaser()
          laser_scr(plw)
          gsync()
              <<" cat $pfname | lpr "
              si_pause(5)
              <" cat $pfname | lpr "

    }

   }

   }






STOP!
